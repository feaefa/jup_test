"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("jsbi"),e=require("decimal.js");function u(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=u(t),n=u(e);function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var u=0,i=new Array(e);u<e;u++)i[u]=t[u];return i}function a(t,e){var u="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(u)return(u=u.call(t)).next.bind(u);if(Array.isArray(t)||(u=function(t,e){if(t){if("string"==typeof t)return r(t,e);var u=Object.prototype.toString.call(t).slice(8,-1);return"Object"===u&&t.constructor&&(u=t.constructor.name),"Map"===u||"Set"===u?Array.from(t):"Arguments"===u||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){u&&(t=u);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=i.default.BigInt(0),d=i.default.BigInt(1),l=i.default.BigInt(2);function s(t){return i.default.GE(t,o)?t:i.default.unaryMinus(t)}function f(t){return t.reduce((function(t,e){return i.default.add(t,e)}),o)}function m(t){return t.reduce((function(t,e){return i.default.multiply(t,e)}),d)}function p(t,e){var u=i.default.divide(t,e);if(i.default.equal(u,o))return[o,e];var n=i.default.remainder(t,e);return i.default.greaterThan(n,o)&&(u=i.default.add(u,d),e=i.default.divide(t,u),n=i.default.remainder(t,u),i.default.greaterThan(n,o)&&(e=i.default.add(e,d))),[u,e]}function c(t,e){return void 0===e&&(e=0),new n.default(t.toString()).div(new n.default(10).pow(e))}var h=function(){function t(t,e,u,i){this.numberOfCurrencies=void 0,this.amplificationFactor=void 0,this.tokenAmounts=void 0,this.targetPrices=void 0,this.numberOfCurrencies=t,this.amplificationFactor=e,this.tokenAmounts=u,this.targetPrices=i}var e=t.prototype;return e.exchange=function(t,e,u,n){void 0===n&&(n=!0);var r=this.xp(),a=i.default.multiply(u,this.targetPrices[t]),o=i.default.add(r[t],a),l=this.computeY(t,e,o),s=i.default.subtract(r[e],l);return n&&(s=i.default.subtract(s,d)),i.default.divide(s,this.targetPrices[e])},e.computeBaseY=function(t,e,u){var r=this.computeD(),a=this.xp(),o=i.default.exponentiate(this.numberOfCurrencies,this.numberOfCurrencies),d=f(a),l=m(a),s=i.default.subtract(i.default.add(i.default.multiply(i.default.multiply(this.amplificationFactor,o),d),r),i.default.multiply(i.default.multiply(this.amplificationFactor,r),o)),p=i.default.multiply(i.default.multiply(i.default.multiply(this.amplificationFactor,o),o),l),c=i.default.multiply(i.default.multiply(o,l),s),h=i.default.add(p,i.default.divide(c,a[t])),v=i.default.add(p,i.default.divide(c,a[e])),g=Math.log10(i.default.toNumber(this.targetPrices[t])),A=Math.log10(i.default.toNumber(this.targetPrices[e])),y=Math.abs(A-g);return i.default.BigInt(g>=A?new n.default(h.toString()).mul(new n.default(u.toString())).div(new n.default(v.toString())).mul(Math.pow(10,y)).floor().toString():new n.default(h.toString()).mul(new n.default(u.toString())).div(new n.default(v.toString())).div(Math.pow(10,y)).floor().toString())},e.computeY=function(t,e,u){var n=this.computeD(),r=this.xp();r[t]=u,r.splice(e,1);for(var m,p=i.default.multiply(this.amplificationFactor,this.numberOfCurrencies),c=n,h=a(r);!(m=h()).done;){var v=m.value;c=i.default.divide(i.default.multiply(c,n),i.default.multiply(v,this.numberOfCurrencies))}c=i.default.divide(i.default.multiply(c,n),i.default.multiply(this.numberOfCurrencies,p));for(var g=i.default.subtract(i.default.add(f(r),i.default.divide(n,p)),n),A=o,y=n;i.default.greaterThan(s(i.default.subtract(y,A)),d);)A=y,y=i.default.divide(i.default.add(i.default.exponentiate(y,l),c),i.default.add(i.default.multiply(l,y),g));return y},e.computeD=function(){for(var t=o,e=this.xp(),u=f(e),n=u,r=i.default.multiply(this.amplificationFactor,this.numberOfCurrencies);i.default.greaterThan(s(i.default.subtract(n,t)),d);){for(var l,m=n,p=a(e);!(l=p()).done;){var c=l.value;m=i.default.divide(i.default.multiply(m,n),i.default.multiply(this.numberOfCurrencies,c))}t=n;var h=i.default.multiply(i.default.add(i.default.multiply(r,u),i.default.multiply(m,this.numberOfCurrencies)),n),v=i.default.add(i.default.multiply(i.default.subtract(r,d),n),i.default.multiply(i.default.add(this.numberOfCurrencies,d),m));n=i.default.divide(h,v)}return n},e.xp=function(){var t=this;return this.tokenAmounts.map((function(e,u){return i.default.multiply(e,t.targetPrices[u])}))},t}(),v=function(){function t(t,e,u,n){this.tokenAmounts=void 0,this.targetPrices=void 0,this.traderFee=void 0,this.curve=void 0,this.tokenAmounts=e,this.targetPrices=u,this.traderFee=n,this.curve=new h(i.default.BigInt(this.tokenAmounts.length),t,this.tokenAmounts,this.targetPrices)}var e=t.prototype;return e.exchange=function(t,e,u,n){var r=this.getOutputAmount(t,u,n),a=this.getFees(r),o=i.default.subtract(r,a);return{priceImpact:this.getPriceImpact(t,o,u,n),fees:a,expectedOutputAmount:o,minOutputAmount:this.getMinimumOutputAmount(o,e)}},e.getPriceImpact=function(t,e,u,r){if(i.default.equal(t,o)||i.default.equal(this.tokenAmounts[u],o)||i.default.equal(this.tokenAmounts[r],o))return new n.default(0);var a=c(this.getOutputAmountWithNoSlippage(t,u,r)),d=c(e);return a.sub(d).div(a)},e.getFees=function(t){return i.default.equal(this.traderFee.numerator,o)?o:i.default.divide(i.default.multiply(t,this.traderFee.numerator),this.traderFee.denominator)},e.getMinimumOutputAmount=function(t,e){return i.default.divide(i.default.multiply(t,i.default.subtract(e.denominator,e.numerator)),e.denominator)},e.getOutputAmount=function(t,e,u){return this.curve.exchange(e,u,t)},e.getOutputAmountWithNoSlippage=function(t,e,u){return this.curve.computeBaseY(e,u,t)},t}(),g=function(){function t(t,e,u,i){this.tokenAmounts=void 0,this.traderFee=void 0,this.ownerFee=void 0,this.curve=void 0,this.tokenAmounts=e,this.traderFee=u,this.ownerFee=i,this.curve=new h(l,t,this.tokenAmounts,[d,d])}var e=t.prototype;return e.exchange=function(t,e,u){var i=0===u?1:0,n=this.getExpectedOutputAmount(t,i,u);return{priceImpact:this.getPriceImpact(t,n,i,u),fees:this.getFees(t),expectedOutputAmount:n,minOutputAmount:this.getMinimumOutputAmount(n,e)}},e.getPriceImpact=function(t,e,u,r){if(i.default.equal(t,o)||i.default.equal(this.tokenAmounts[u],o)||i.default.equal(this.tokenAmounts[r],o))return new n.default(0);var a=c(this.getExpectedOutputAmountWithNoSlippage(t,u,r)),d=c(e);return a.sub(d).div(a)},e.getFees=function(t){var e=i.default.equal(this.traderFee.numerator,o)?o:i.default.divide(i.default.multiply(t,this.traderFee.numerator),this.traderFee.denominator),u=i.default.equal(this.ownerFee.numerator,o)?o:i.default.divide(i.default.multiply(t,this.ownerFee.numerator),this.ownerFee.denominator);return i.default.add(e,u)},e.getExpectedOutputAmount=function(t,e,u){var i=this.getInputAmountLessFees(t);return this.getOutputAmount(i,e,u)},e.getExpectedOutputAmountWithNoSlippage=function(t,e,u){var i=this.getInputAmountLessFees(t);return this.getOutputAmountWithNoSlippage(i,e,u)},e.getMinimumOutputAmount=function(t,e){return i.default.divide(i.default.multiply(t,i.default.subtract(e.denominator,e.numerator)),e.denominator)},e.getInputAmountLessFees=function(t){return i.default.subtract(t,this.getFees(t))},e.getOutputAmount=function(t,e,u){return this.curve.exchange(e,u,t,!1)},e.getOutputAmountWithNoSlippage=function(t,e,u){return this.curve.computeBaseY(e,u,t)},t}(),A=function(){function t(t,e,u,i){void 0===i&&(i=!0),this.tokenAmounts=void 0,this.traderFee=void 0,this.ownerFee=void 0,this.feesOnInput=void 0,this.tokenAmounts=t,this.traderFee=e,this.ownerFee=u,this.feesOnInput=i}var e=t.prototype;return e.exchange=function(t,e,u){var i=0===u?1:0,n=this.feesOnInput?this.getAmountLessFees(t):t,r=this.getExpectedOutputAmount(n,i,u),a=this.getFees(this.feesOnInput?t:r);return this.feesOnInput||(r=this.getAmountLessFees(r)),{priceImpact:this.getPriceImpact(n,r,i,u),fees:a,expectedOutputAmount:r,minOutputAmount:this.getMinimumOutputAmount(r,e)}},e.getPriceImpact=function(t,e,u,r){if(i.default.equal(t,o)||i.default.equal(this.tokenAmounts[u],o)||i.default.equal(this.tokenAmounts[r],o))return new n.default(0);var a=c(this.getExpectedOutputAmountWithNoSlippage(t,u,r)),d=c(e);return a.sub(d).div(a)},e.getFees=function(t){var e=i.default.equal(this.traderFee.numerator,o)?o:i.default.divide(i.default.multiply(t,this.traderFee.numerator),this.traderFee.denominator),u=i.default.equal(this.ownerFee.numerator,o)?o:i.default.divide(i.default.multiply(t,this.ownerFee.numerator),this.ownerFee.denominator);return i.default.add(e,u)},e.getExpectedOutputAmount=function(t,e,u){return this.getOutputAmount(t,e,u)},e.getExpectedOutputAmountWithNoSlippage=function(t,e,u){if(i.default.equal(this.tokenAmounts[e],o))return this.tokenAmounts[u];var n=i.default.divide(i.default.multiply(t,this.tokenAmounts[u]),this.tokenAmounts[e]);return this.feesOnInput?n:this.getAmountLessFees(n)},e.getMinimumOutputAmount=function(t,e){return i.default.divide(i.default.multiply(t,i.default.subtract(e.denominator,e.numerator)),e.denominator)},e.getAmountLessFees=function(t){return i.default.subtract(t,this.getFees(t))},e.getOutputAmount=function(t,e,u){var n=[this.tokenAmounts[e],this.tokenAmounts[u]],r=n[0],a=n[1],o=p(this.getInvariant(),i.default.add(r,t));return i.default.subtract(a,o[0])},e.getInvariant=function(){return i.default.multiply(this.tokenAmounts[0],this.tokenAmounts[1])},t}();exports.Fraction=function(t,e){this.numerator=void 0,this.denominator=void 0,this.numerator=t,this.denominator=e},exports.ONE=d,exports.Stable=v,exports.TWO=l,exports.TokenSwapConstantProduct=A,exports.TokenSwapStable=g,exports.ZERO=o,exports.abs=s,exports.ceilingDivision=p,exports.mulArray=m,exports.sumArray=f,exports.toDecimal=c;
//# sourceMappingURL=math.cjs.production.min.js.map
